---
import "../styles/global.css";

import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';

const path = Astro.url.pathname.replace(/\//g, '') || 'index';
const { title } = Astro.props;
---
<script>
import Swup from 'swup'; 

const swup = new Swup({
    containers: ['#swup']
});

// Height transition for container
swup.hooks.on('visit:start', () => {
    const container = document.getElementById('layout-container');
    if (container) {
        // Lock the height to current pixel value before content changes
        container.style.height = `${container.offsetHeight}px`;
    }
});

swup.hooks.before('animation:in:start', async () => {
    const container = document.getElementById('layout-container');
    if (!container) return;

    // We have the new content in DOM (opacity 0), but container height is locked to old height.
    // 1. Measure new required height (by temporary unlock)
    const currentHeight = container.style.height;
    container.style.height = 'auto';
    const targetHeight = container.offsetHeight;
    container.style.height = currentHeight;
    
    // Force reflow
    container.offsetHeight;

    // 2. Animate to new height
    container.style.transition = 'height 0.5s ease-in-out';
    container.style.height = `${targetHeight}px`;

    // 3. Wait for animation to finish
    await new Promise((resolve) => setTimeout(resolve, 500));

    // Cleanup
    container.style.height = 'auto';
    container.style.transition = '';
});
</script>

<!doctype html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    <title>FakeImg Clone{title ? ` - ${title}` : ``}</title>
    <link rel="icon" href="/favicon.png" type="image/png">
    <style>
        html.is-changing .transition-fade {
        transition: opacity 0.5s;
        opacity: 1;
        }
        html.is-animating .transition-fade {
        opacity: 0;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-base-200">
<div class="container grid mx-auto p-4">

    <Navbar />

    <div id="layout-container" class="container mx-auto bg-base-100 shadow-lg rounded-xl p-4 md:p-8">
        <!-- <main class="" data-barba="wrapper"> -->
        <main id="swup" class="transition-fade">
            <div class="grid" data-barba="container" data-barba-namespace={path}>
                    <slot />
            </div>
        </main>
    </div>

    <div class="container mx-auto mt-8">
        <footer>
            <Footer />
        </footer>
    </div>
</div>
</body>
</html>
